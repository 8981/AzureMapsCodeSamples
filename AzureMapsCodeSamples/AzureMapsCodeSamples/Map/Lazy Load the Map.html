<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />

    <script type='text/javascript'>
        var map;

        function LoadMapControl() {
            if (!LazyMapLoader.IsLoaded()) {
                LazyMapLoader.LoadMapControl(GetMap);
            } else if (map == null) {
                GetMap();
            }
        }

        function GetMap() {
            map = new atlas.Map('myMap', {
                'subscription-key': '<subscriptionKey>',
                center: [-122.33, 47.64],
                zoom: 12
            });
        }

        //A reusable class that makes it easy to lazy load the Azure Maps Atlas map SDK. 
        var LazyMapLoader = new function () {
            var _callback = null, _isLoading = false;

            function isLoaded() {
                //Verify that the atlas namespace is loaded and that the Map class is recognized.
                return typeof (atlas) != 'undefined'
                    && typeof (atlas.Map) != 'undefined';
            }

            this.LoadMapControl = function (callback) {
                var loaded = isLoaded();
                if (!_isLoading && !loaded) {
                    _callback = callback;
                    _isLoading = true;

                    //Load the Atlas CSS Styles.
                    var styles = document.createElement('link');
                    styles.setAttribute('type', 'text/css');
                    styles.setAttribute('rel', 'stylesheet');
                    styles.setAttribute('href', 'https://atlas.microsoft.com/sdk/css/atlas.min.css?api-version=1.0');
                    document.body.appendChild(styles);

                    //Load the Atlas JavaScript SDK.
                    var script = document.createElement('script');
                    script.setAttribute('type', 'text/javascript');
                    script.setAttribute('src', 'https://atlas.microsoft.com/sdk/js/atlas.min.js?api-version=1.0');
                    document.body.appendChild(script);
                    
                    setTimeout('LazyMapLoader.__LoadCallback();', 100);
                } else if (loaded) {
                    _callback();
                }
            };

            this.IsLoaded = function () {
                return isLoaded();
            };

            this.__LoadCallback = function () {
                if (isLoaded()) {
                    _callback();
                    _isLoading = false;
                } else {
                    setTimeout('LazyMapLoader.__LoadCallback();', 100);
                }
            };
        };
    </script>
</head>
<body onload="GetMap()">
    <input type="button" onclick="LoadMapControl()" value="Load Map" />

    <div id="myMap" style="position:relative;width:800px;height:600px;"></div>

    <fieldset style="width:800px;margin-top:10px;">
        <legend>Lazy Load the Map Sample</legend>
        This sample shows how to delay the loading of the map SDK until it is needed. This is useful if your map is hiden and not displayed by default (i.e. hosted in a tab). 
        By waiting until the user actually needs the map before loading it, you can reduce the amount of resources the browser usesinitially and speed up your page loading 
        while also reducing the number of transactions that are generated by your application and thus reducing your costs. 
    </fieldset>
</body>
</html>